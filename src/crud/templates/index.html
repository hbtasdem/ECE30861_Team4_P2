<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Model Registry API - Upload and manage ML models, datasets, and code"
    />
    <title>Model Registry API - BoilerFace</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        padding: 2rem;
        background: #f0f2f5;
        color: #1a1a1a;
      }

      .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: #000;
        color: #fff;
        padding: 8px 12px;
        text-decoration: none;
        z-index: 100;
        border-radius: 4px;
      }
      .skip-link:focus {
        top: 0;
      }

      header[role="banner"] {
        margin-bottom: 1.5rem;
      }
      h1 {
        text-align: center;
        margin-bottom: 1rem;
        font-size: 2rem;
      }
      h2 {
        margin-bottom: 1rem;
        font-size: 1.5rem;
      }

      .card {
        background: #fff;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 600px;
        margin: 1rem auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 1.25rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
      }

      input[type="url"] {
        width: 100%;
        padding: 0.75rem;
        border-radius: 0.5rem;
        border: 2px solid #666;
        font-size: 1rem;
      }
      input[type="url"]:focus {
        outline: 3px solid #4338ca;
        outline-offset: 2px;
        box-shadow: 0 0 0 3px rgba(67, 56, 202, 0.2);
      }

      button {
        padding: 0.75rem 1.5rem;
        background: #4338ca;
        color: #fff;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
      }
      button:hover {
        background: #3730a3;
      }
      button:focus {
        outline: 3px solid #4338ca;
        outline-offset: 2px;
      }
      button:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        opacity: 0.7;
      }

      .help-text {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
        color: #444;
      }

      .status-message {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: 0.5rem;
        font-weight: bold;
      }
      .error {
        background: #fee2e2;
        color: #991b1b;
        border: 2px solid #dc2626;
      }
      .success {
        background: #d1fae5;
        color: #065f46;
        border: 2px solid #10b981;
      }
      .loading {
        background: #dbeafe;
        color: #1e40af;
        border: 2px solid #3b82f6;
      }

      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      nav ul {
        list-style-position: inside;
        padding-left: 0;
      }
      nav li {
        margin-bottom: 0.75rem;
      }
      a {
        color: #4338ca;
        font-weight: bold;
      }
      a:focus {
        outline: 3px solid #4338ca;
        outline-offset: 2px;
        border-radius: 2px;
      }
    </style>
  </head>

  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header role="banner">
      <h1>ðŸ¤– BoilerFace Model Registry</h1>
    </header>

    <main id="main-content" role="main">
      <!-- REQUIRED by tests -->
      <section class="card" aria-labelledby="upload-heading">
        <h2 id="upload-heading">Upload Model</h2>

        <form id="uploadForm" onsubmit="uploadModel(event)">
          <div class="form-group">
            <label for="modelUrl">Model URL</label>
            <input
              type="url"
              id="modelUrl"
              name="modelUrl"
              placeholder="https://huggingface.co/..."
              required
              aria-required="true"
              aria-describedby="url-help"
              aria-invalid="false"
            />
            <span id="url-help" class="help-text">
              Enter the full URL of the model from Hugging Face or GitHub
            </span>
          </div>

          <button
            type="submit"
            id="uploadBtn"
            aria-label="Upload model to registry"
          >
            Upload Model
          </button>
        </form>

        <div
          id="statusRegion"
          role="status"
          aria-live="polite"
          aria-atomic="true"
        ></div>
        <div id="responseContainer" aria-live="polite" aria-atomic="true"></div>
      </section>

      <nav aria-labelledby="links-heading" class="card">
        <h2 id="links-heading">Quick Links</h2>
        <ul>
          <li>
            <a href="/health" target="_blank" rel="noopener noreferrer">
              Health Check
              <span class="visually-hidden">(opens in new tab)</span>
            </a>
          </li>
          <li>
            <a
              href="/health/components"
              target="_blank"
              rel="noopener noreferrer"
            >
              Component Health Details
              <span class="visually-hidden">(opens in new tab)</span>
            </a>
          </li>
          <li>
            <a href="/docs" target="_blank" rel="noopener noreferrer">
              Swagger API Documentation
              <span class="visually-hidden">(opens in new tab)</span>
            </a>
          </li>
          <li>
            <a href="/redoc" target="_blank" rel="noopener noreferrer">
              ReDoc API Documentation
              <span class="visually-hidden">(opens in new tab)</span>
            </a>
          </li>
        </ul>
      </nav>
    </main>

    <script>
      async function uploadModel(event) {
        event.preventDefault();

        const input = document.getElementById("modelUrl");
        const btn = document.getElementById("uploadBtn");
        const statusRegion = document.getElementById("statusRegion");
        const responseContainer = document.getElementById("responseContainer");

        statusRegion.innerHTML = "";
        responseContainer.innerHTML = "";
        input.setAttribute("aria-invalid", "false");

        const url = input.value.trim();
        if (!url) {
          // HTML5 required will usually handle, but keep accessible error too
          showError("Please enter a Model URL.");
          input.setAttribute("aria-invalid", "true");
          input.focus();
          return;
        }

        btn.disabled = true;
        input.disabled = true;

        statusRegion.innerHTML = `
          <div class="status-message loading">
            Uploading model, please wait...
          </div>
        `;

        try {
          const headers = { "Content-Type": "application/json" };

          // If you ever add token auth, keep it optional (won't break tests)
          const token = localStorage.getItem("authToken");
          if (token) headers["X-Authorization"] = token;

          // IMPORTANT: endpoint unchanged from your backend: POST /artifact/model
          const res = await fetch("/artifact/model", {
            method: "POST",
            headers,
            body: JSON.stringify({ url }),
          });

          let data = null;
          try {
            data = await res.json();
          } catch (_) {
            data = { detail: "Non-JSON response from server" };
          }

          if (!res.ok) {
            showError(data.detail || "Upload failed.");
            input.setAttribute("aria-invalid", "true");
            return;
          }

          showSuccess("Model uploaded successfully!");
          responseContainer.innerHTML = `<pre>${escapeHtml(
            JSON.stringify(data, null, 2)
          )}</pre>`;
          input.value = "";
        } catch (err) {
          showError("Failed to upload model: " + err.message);
          input.setAttribute("aria-invalid", "true");
        } finally {
          btn.disabled = false;
          input.disabled = false;
          input.focus();
        }
      }

      function showError(message) {
        const statusRegion = document.getElementById("statusRegion");
        statusRegion.innerHTML = `
          <div class="status-message error" role="alert">
            <strong>Error:</strong> ${escapeHtml(message)}
          </div>
        `;
      }

      function showSuccess(message) {
        const statusRegion = document.getElementById("statusRegion");
        statusRegion.innerHTML = `
          <div class="status-message success" role="status">
            <strong>Success:</strong> ${escapeHtml(message)}
          </div>
        `;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = String(text);
        return div.innerHTML;
      }
    </script>
  </body>
</html>
